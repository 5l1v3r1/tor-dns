\subsection{Website fingerprinting}
We have to overcome the following problems:
\begin{itemize}
	\item DNS sniffing only tells us what \emph{domains}, but not what
		\emph{pages} a user visits.  Can be a big problem, e.g., with Wikipedia.
	\item DNS records are cached by the resolver for the duration of the TTL.
\end{itemize}

The following aspects might work in our favor:
\begin{itemize}
	\item When visiting a page, your browser sends \emph{multiple} DNS queries.
	\item In tor, the DNS cache enforces a minimum TTL of 60 seconds and a maximum
	TTL of 30 minutes (see tor/src/or/dns.c:278).
\end{itemize}


\subsubsection{DNS dataset}
%TODO: Tobias

The adversary considers a set of webpages that we call \textbf{DNS
Analyzed Webpages (DAW)}. Note that this set might be different from the
set of monitored/unmonitored webpages that the adversary collected
traffic traces on the ingress side for. 

For each webpage the adversary observes which domains are requested by
the browser when loading the webpage. The set of domains requested,
their order, uniqueness, how stable they are over several repetitions of
loading the webpage, and what TTL they have, comprises the
\textbf{Webpage DNS Fingerprint (WDF)} of the webpage.

The adversary constructs a dataset that maps each webpage in the DAW set
to it's WDF. 


\subsubsection{Enhancing WF Attacks with DNS Data}

% attack only one client
We take a client-centric view and assume that the adversary focuses on
one client to attack\footnote{This is a simplification and might underestimate
the adversary's power, because monitoring the traffic of several users
on the ingress-side is easily possible, for example when the adversary
operates one or more Tor entry guards.}.

% see several exits 
We assume that the adversary observes DNS traffic from several exit
relays (either by operating a DNS resolver used by several exit relays,
or sniffing traffic from several exit relays to one or more DNS
resolvers).
%
% terminology observe/un-observed/client's exits
We distinguish between \textbf{observed exits}, \ie exit relays that use
DNS resolvers that are controlled or monitored by the adversary,
\textbf{un-observed exits}, \ie all exit relays except the observed
exits, and the \textbf{client's exit}, \ie the exit relay used by the
client for the current request. 
%
% client's exit unknown
Note that the adversary does not know a priori which exit relay the
client uses, so the client's exit can be among the observed exits or the
un-observed exits.

% 
We now describe how the adversary can use the data from the observed
exits to enhance website fingerprinting attacks.


\subsubsection{Egress DNS Request Analysis}

The adversary sees all DNS traffic of all observed exits, that is fully
qualified website domain names (not webpage URLs though), timestamped
and grouped per exit relay (\eg labelled with the exit relay's IP
address).

When observing a new website request on the ingress side, that is a 
traffic trace starting at time $t_0$, the adversary takes a snapshot
of the continuously recorded DNS traffic data, including only those queries
that have timestamps in the time-period from $t_0 - c$ to $t_0 + d$,
where $c$ is the maximum TTL (30 min) and $d$ is the maximum delay
for DNS queries that can be caused by longer page load times and Tor
latency (probably one minute is enough?).

If the user used one of the observed exits for the website request, then
all DNS queries generated by this website request (\ie all domains in
the website's WDF) are included in the snapshot. This is the case
because even if one domain name was already cached at the exit relay
(because this or another user of that exit visited the website before),
it must have been queried for during the last $c$ minutes, otherwise its
TTL would have expired and it would have been requested again (latest
$d$ minutes after the website request was issued). 

\subsubsection{Two-classifier Approach}
(use DNS data as a separate classifier, that is look what websites fit
to the snapshot set, and combine the resulting probability distribution
with the one of a traditional WF classifier taking the website request
on the ingress side as input) 
%TODO: Benjamin (copy+paste+polish from wiki)


\subsubsection{Close-the-world Approach}
(use snapshot set domains to inform the construction of the training set
for a WF classifier working on the ingress side) 
%TODO: Benjamin (copy+paste+polish from wiki)


