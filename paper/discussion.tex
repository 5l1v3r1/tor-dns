\section{Discussion}
\label{sec:discussion}

\subsection{Ethical considerations}
\label{sec:ethics}

Section~\ref{sec:load-freq} discusses how we set up an exit relay to determine
the number of DNS requests per five minute interval.  Since our exit relay was
forwarding traffic of Tor users, we contacted our university's institutional
review board (IRB) before running the experiment.  Our IRB ruled that its
approval is not applicable because the limited data we wanted to collect did not
fall under human subjects research.  In addition to contacting our IRB, we
adhered to The Tor Project's ethics guidelines~\cite{ethics-guidelines}.  In
particular, \first we ensured that we only collected data that is safe to
publish, \second we only collected data we needed, and \third we limited the
granularity of the data to minimize the likelihood of reidentification.  We deem
the risk to Tor users negligible.  As for the benefits, by conducting this
experiment, we can improve our understanding of the risks that Tor users face
and work towards mitigation methods.  In summary, we believe that the benefits
of our experiment outweigh the risks.

\subsection{Mitigation}
We now discuss ways to mitigate the issues our work raised.  We distinguish
between short-term solutions that could be implemented quickly
(\S~\ref{sec:short-term}), and long-term solution that need significantly more
work (\S~\ref{sec:long-term}).

\subsubsection{Short-term solutions}
\label{sec:short-term}
Exit relays seem stuck in a predicament, having to choose between running their
own resolver (which exposes DNS queries to network adversaries) and using a
third-party resolver (which exposes DNS queries to a third party).  If we were
given the choice to reconfigure the DNS setup of all exit relays, what would we
do?  Clearly, the goal is to minimize exposure of DNS requests, but there are
several dimensions to this.  Ignoring substantial DNS protocol improvements for
now, we can envision three extreme scenarios, in which \emph{all} exit relays
use either \first Google's DNS resolver; \second their own, local resolver; or
\third the resolver provided by their ISP.  If all exit relays would use Google,
the company would obtain metadata about the activity of all Tor users---a clear
violation of Tor's design goal of distributing trust.  This scenario is clearly
to avoid.\footnote{To make matters worse, Fifield et al.'s~\cite{Fifield2015a}
censorship circumvention system meek leveraged Google's cloud infrastructure
to reach the Tor network up until May 2016.
% died May 13, 2006. See https://lists.torproject.org/pipermail/tor-talk/2016-June/041699.html
Inevitably, many of the thousands of meek clients
will select exit relays that use Google's DNS resolver, which means that Google
gets to see both traffic entering \emph{and}, partially, exiting the Tor
network.} Next, let us imagine a Tor network that only uses local resolvers.  In
that case, Tor is fully independent of third-party resolvers, but at the cost of
the DNS resolution process being exposed to the network, allowing several
parties to learn what domains Tor users are looking up.  Finally, all exit
relays could simply use their ISP-provided resolver.  This would minimize the
network exposure of DNS requests as resolvers are frequently in the same AS as
exit relays, and network-level adversaries would be unable to distinguish
between DNS requests from exit relays and unrelated ISP customers.  This setup,
however, comes at the cost of potentially misconfigured and censored DNS
resolvers~\cite[\S~4.1]{Winter2014b}.  Besides, just a few ASes---OVH, for
example---host a disproportionate amount of exit relays, turning them into the
very centralized data trough we seek to avoid.  Table~\ref{tab:setup-comparison}
recapitulates the key aspects of all three setups.  Considering the above, we
believe that exit relay operators should avoid public resolvers such as Google
and OpenDNS.  Instead, they should either use the resolvers provided by their
ISP, or run their own---in particular, if their ISP already hosts many other
exit relays.  Local resolvers can further be optimized to minimize information
leakage, e.g., by configuring QNAME minimization~\cite{qname-minimization}.

\begin{table}[t]
	\centering
	\begin{tabular}{l c c c}
	\toprule
	\textbf{Setup} &
	\begin{tabular}{@{}c@{}}\textbf{Network-level}\\\textbf{protection}\end{tabular} &
	\begin{tabular}{@{}c@{}}\textbf{Level of}\\\textbf{Centralization}\end{tabular} &
	\begin{tabular}{@{}c@{}}\textbf{Response}\\\textbf{quality}\end{tabular} \\
	\midrule
	All Google & \RIGHTcircle & \Circle & \CIRCLE \\
	All Local & \Circle & \CIRCLE & \CIRCLE\\
	All ISP & \CIRCLE & \RIGHTcircle & \RIGHTcircle \\
	\bottomrule
	\end{tabular}
	\caption{A comparison between three hypothetical DNS setups for all exit
	relays.  Full circles are desirable.}
	\label{tab:setup-comparison}
\end{table}

Besides making recommendations to exit relay operators, we can remotely
influence the cache of each exit relay's resolver.  For example, using exitmap,
we can resolve the domain sensitive.org over each exit relay continuously, right
before its TTL is about to expire.  That way an attacker gains no advantage from
observing DNS since sensitive.org is always in every exits' cache.
Clearly, this approach does not scale, but it
allows us to eliminate DNS-based correlation attacks for a select number of
sites.

Tor can fix the Tor clipping bug and consider significantly increasing the
minimum TTL for the DNS cache at exits to make \name attacks less precise.
This requires finding the longest acceptable TTL that does not have a
notable negative impact on functionality.

\subsubsection{Long-term solutions}
\label{sec:long-term}
Practical defenses are on the horizon.  Zhu et al.~\cite{Zhu2015a} proposed
T-DNS, which employs a number of TCP optimizations to transport the DNS protocol
over TLS and TCP.  Since T-DNS is based on TCP, it can be readily sent over Tor.
The TLS layer provides confidentiality between exit relays and their resolvers.
Finally, site operators whose users are particularly concerned about their
safety should offer an onion service as an alternative.  Facebook, for example,
set up \url{facebookcorewwwi.onion} as an alternative front-end.  When
connecting to the onion service, Tor users never leave the Tor network, and
hence no not need DNS.

While growing the Tor network will have a minor impact on protecting against
\name attacks, the most important change is to deploy a WF defense. The
WF defense should be tuned to significantly reduce the recall of WF attacks,
even when the WF attack is configured to sacrifice precision for recall, since
\name attacks significantly increase precision.
